(()=>{"use strict";var t,e,i,s=function(){function t(t,e,i){this.max=e,this.min=t,this.delta=i,this.value=Math.floor((this.max-this.min)/2)+this.min,this.oscillation=!0}return t.prototype.update=function(){this.value+=this.delta,!0===this.oscillation&&(this.value<=this.min&&this.delta<0||this.value>=this.max&&this.delta>0)&&(this.delta=-this.delta),this.value<this.min&&(this.value=this.min),this.value>this.max&&(this.value=this.max)},t.prototype.setToMax=function(){this.value=this.max},t.prototype.setToMin=function(){this.value=this.min},t.prototype.getValue=function(){return this.value},t.prototype.setDelta=function(t){this.delta=t},t.prototype.setMax=function(t){this.max=t},t.prototype.setMin=function(t){this.min=t},t.prototype.setValue=function(t){this.value=t},t.prototype.setOscillation=function(t){this.oscillation=t},t.prototype.randomize=function(){var t=Math.floor(Math.random()*this.max-this.min);this.value=this.min+t},t}(),n=function(){function t(t){void 0===t&&(t=1),this.r=new s(0,255,Math.random()*t),this.r.randomize(),this.g=new s(0,255,Math.random()*t),this.g.randomize(),this.b=new s(0,255,Math.random()*t),this.b.randomize()}return t.prototype.update=function(){this.r.update(),this.g.update(),this.b.update()},t.prototype.setOscillationSpeedFactor=function(t){this.r.setDelta(Math.random()*t),this.g.setDelta(Math.random()*t),this.b.setDelta(Math.random()*t)},t.prototype.getColor=function(){var t=this.r.getValue(),e=this.g.getValue(),i=this.b.getValue();return"rgb(".concat(t,",").concat(e,",").concat(i,")")},t}(),o=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.rotate=function(t){var e,i,s,n,o;o=-t*(Math.PI/180),s=Math.cos(o),n=Math.sin(o),e=this.x,i=this.y,this.x=e*s-i*n,this.y=e*n+i*s},t.prototype.add=function(t){this.x+=t.x,this.y+=t.y},t.prototype.sub=function(t){this.x-=t.x,this.y-=t.y},t.prototype.scale=function(t){this.x*=t,this.y*=t},t.prototype.normalize=function(){var t;0!==(t=this.magnitude())&&(this.x=this.x/t,this.y=this.y/t)},t.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.distanceTo=function(t){var e=this.clone();return e.sub(t),e.magnitude()},t.prototype.clone=function(){return new t(this.x,this.y)},t}(),h=function(){function t(t,e){this.alive=!0,this.color=new n(0),this.context=t,this.hidden=!1,this.lineWidth=new s(1,3,.01),this.radius=new s(4,6,.02),this.pos=new o(Math.floor(Math.random()*(e.x-60))+30,Math.floor(Math.random()*(e.y-60))+30)}return t.prototype.update=function(){this.color.update(),this.lineWidth.update(),this.radius.update()},t.prototype.draw=function(){var t;(t=this.context).lineCap="round",t.lineJoin="round",t.strokeStyle=this.color.getColor(),t.lineWidth=this.lineWidth.getValue(),t.beginPath(),t.arc(this.pos.x,this.pos.y,this.radius.getValue(),0,2*Math.PI),t.stroke()},t.prototype.explode=function(){this.alive=!1,this.lineWidth.setOscillation(!1),this.lineWidth.setMin(1e-4),this.lineWidth.setDelta(-.02),this.radius.setMax(99999),this.radius.setDelta(1)},t.prototype.touchedByTurtle=function(t){var e=this;return!1!==this.alive&&this.pos.distanceTo(t.getPos())<=Math.floor(this.radius.getValue()/2)+Math.floor(t.getWidth())&&(this.explode(),setTimeout((function(){e.hidden=!0}),1e3),!0)},t.prototype.isHidden=function(){return this.hidden},t}(),a=function(){function t(t,e,i){this.angle=45,this.angleDelta=new s(0,0,0),this.angleDelta.setOscillation(!1),this.baseDirection=new o(0,1),this.color=new n(.4),this.context=t,this.fieldSize=i,this.length=new s(16,999,0),this.length.setOscillation(!1),this.length.setValue(16),this.pos=e,this.speed=new s(1.2,2,0),this.speed.setOscillation(!1),this.speed.setValue(1.2),this.steerSpeed=.9,this.steerSpeedDelta=.001,this.steerSpeedMax=3,this.width=new s(1e-4,10,0),this.width.setOscillation(!1),this.width.setValue(10)}return t.prototype.update=function(t){var e;0!=this.angleDelta.getValue()&&(this.angle+=this.angleDelta.getValue(),this.angle>360&&(this.angle-=360),this.angle<0&&(this.angle=360+this.angle)),(e=this.baseDirection.clone()).rotate(this.angle),e.normalize(),e.scale(this.speed.getValue()*t*.1),this.pos.add(e),this.pos.x<0&&(this.pos.x=this.fieldSize.x),this.pos.x>this.fieldSize.x&&(this.pos.x=0),this.pos.y<0&&(this.pos.y=this.fieldSize.y),this.pos.y>this.fieldSize.y&&(this.pos.y=0),this.angleDelta.update(),this.color.update(),this.length.update(),this.speed.update(),this.width.update()},t.prototype.draw=function(){var t,e,i,s,n;function h(e,h){(s=new o(e,h)).sub(i),(n=new o(e,h)).add(i),t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(n.x,n.y),t.stroke()}(t=this.context).lineCap="round",t.lineJoin="round",t.strokeStyle=this.color.getColor(),t.lineWidth=this.width.getValue(),e=this.length.getValue()/2,(i=this.baseDirection.clone()).rotate(this.angle),i.normalize(),i.scale(e),h(this.pos.x,this.pos.y),this.pos.x<e&&h(this.fieldSize.x-1+this.pos.x,this.pos.y),this.pos.x>=this.fieldSize.x-e&&h(-(this.fieldSize.x-1-this.pos.x),this.pos.y),this.pos.y<e&&h(this.pos.x,this.fieldSize.y+this.pos.y),this.pos.y>=this.fieldSize.y-e&&h(this.pos.x,-(this.fieldSize.y-1-this.pos.y))},t.prototype.boost=function(){var t=this;this.color.setOscillationSpeedFactor(5),setTimeout((function(){t.color.setOscillationSpeedFactor(.4)}),1500),this.speed.setToMax(),this.speed.setDelta(-.002),this.width.setValue(5),this.width.setDelta(.1)},t.prototype.explode=function(){this.length.setMax(999),this.length.setDelta(.5),this.width.setDelta(-.1)},t.prototype.turnStartLeft=function(){0==this.angleDelta.getValue()&&(this.angleDelta.setDelta(this.steerSpeedDelta),this.angleDelta.setValue(this.steerSpeed),this.angleDelta.setMax(this.steerSpeedMax))},t.prototype.turnStartRight=function(){0==this.angleDelta.getValue()&&(this.angleDelta.setDelta(-this.steerSpeedDelta),this.angleDelta.setValue(-this.steerSpeed),this.angleDelta.setMin(-this.steerSpeedMax))},t.prototype.turnStop=function(){this.angleDelta.setDelta(0),this.angleDelta.setValue(0),this.angleDelta.setMin(0),this.angleDelta.setMax(0)},t.prototype.getPos=function(){return this.pos},t.prototype.getWidth=function(){return this.width.getValue()},t}(),r=function(){function t(t,e){this.canvas=t,this.config=e,this.context=t.getContext("2d"),this.started=!1,this.lastTick=Date.now(),this.finalTime="",this.inputsCount=0;var i=Math.floor(this.canvas.width/2),s=Math.floor(this.canvas.height/2);this.posTextCenter=new o(i,s),this.posTextTimer=new o(this.canvas.width-30,this.canvas.height-30),this.posTextInputsCounter=new o(this.canvas.width-30,30),this.initEnitities(),this.clearCanvas(),this.drawText()}return t.prototype.initEnitities=function(){var t=new o(this.canvas.width,this.canvas.height);this.turtle=new a(this.context,this.posTextCenter.clone(),t),this.coins=[new h(this.context,t),new h(this.context,t),new h(this.context,t)],this.coinsAlive=this.coins.length},t.prototype.tick=function(){var t,e;e=(t=Date.now())-this.lastTick,this.update(e),this.draw(),this.fps=1e3/e,this.lastTick=t},t.prototype.update=function(t){var e=this;this.turtle.update(t),this.coins.forEach((function(t){!1===t.isHidden()&&(t.update(),!0===t.touchedByTurtle(e.turtle)&&(e.coinsAlive-=1,e.turtle.boost(),0===e.coinsAlive&&(e.finalTime=e.getPlayTime(),e.turtle.explode(),setTimeout((function(){e.stop()}),1e3))))}))},t.prototype.draw=function(){this.clearCanvas(),this.turtle.draw(),this.coins.forEach((function(t){!1===t.isHidden()&&t.draw()})),this.drawText()},t.prototype.drawText=function(){var t;t=this.context,!1===this.started?(t.lineWidth=3,t.lineCap="round",t.lineJoin="round",t.fillStyle=this.config.fontColor,t.font="30px ".concat(this.config.fontColor," Arial"),t.textAlign="center",t.fillText("Press SPACE or touch screen",this.posTextCenter.x,this.posTextCenter.y)):(t.lineWidth=1,t.lineCap="round",t.lineJoin="round",t.fillStyle=this.config.fontColor,t.font="15px ".concat(this.config.fontColor," Arial"),t.textAlign="center",t.fillText(this.getPlayTime(),this.posTextTimer.x,this.posTextTimer.y),t.fillText(this.inputsCount.toString(),this.posTextInputsCounter.x,this.posTextInputsCounter.y)),this.finalTime.length>0&&(t.lineWidth=3,t.lineCap="round",t.lineJoin="round",t.fillStyle=this.config.fontColor,t.font="30px ".concat(this.config.fontColor," Arial"),t.textAlign="center",t.fillText("Inputs: ".concat(this.inputsCount),this.posTextCenter.x,this.posTextCenter.y-110),t.fillText("Time: ".concat(this.finalTime),this.posTextCenter.x,this.posTextCenter.y-60))},t.prototype.clearCanvas=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.getPlayTime=function(){return this.finalTime.length>0?this.finalTime:((Date.now()-this.startTime)/1e3).toFixed(2)},t.prototype.stop=function(){this.started=!1,clearInterval(this.interval),this.clearCanvas(),this.drawText()},t.prototype.start=function(){var t=this;this.initEnitities(),this.started=!0,this.lastTick=Date.now(),this.startTime=this.lastTick,this.finalTime="",this.interval=setInterval((function(){return t.tick()}),1),this.inputsCount=0},t.prototype.keyDown=function(t){"ArrowLeft"===t&&(0===this.finalTime.length&&this.inputsCount++,this.turtle.turnStartLeft()),"ArrowRight"===t&&(0===this.finalTime.length&&this.inputsCount++,this.turtle.turnStartRight()),"KeyR"===t&&this.stop()},t.prototype.keyUp=function(t){"Space"===t&&!1===this.started&&this.start(),"ArrowLeft"===t&&this.turtle.turnStop(),"ArrowRight"===t&&this.turtle.turnStop()},t.prototype.touchStart=function(t){t.touches[0].clientX<this.posTextCenter.x?(this.inputsCount++,this.turtle.turnStartLeft()):(this.inputsCount++,this.turtle.turnStartRight())},t.prototype.touchEnd=function(){!1!==this.started?this.turtle.turnStop():this.start()},t.prototype.getFPS=function(){return this.fps},t.prototype.getStarted=function(){return this.started},t}(),l=document.currentScript.getAttribute("clr");null===l?("clr-font","black",t=null===(e=document.currentScript.getAttribute("clr-font"))?"black":e):t=l,(i=document.getElementById("turtlemania-canvas")).height=i.clientHeight,i.width=i.clientWidth;var u=new function(t){this.fontColor=t}(t),p=new r(i,u);window.addEventListener("keydown",(function(t){("Space"==t.code||t.code.startsWith("Arrow"))&&t.preventDefault(),"KeyF"!=t.code?p.keyDown(t.code):d()}),!1),window.addEventListener("keyup",(function(t){p.keyUp(t.code)}),!1),i.addEventListener("touchstart",(function(t){return t.preventDefault(),t.stopPropagation(),p.touchStart(t),!1}),!1),i.addEventListener("touchend",(function(t){return t.preventDefault(),t.stopPropagation(),p.touchEnd(),!1}),!1);var c=document.getElementById("btn-fullscreen");function d(){var t;(t=i).requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}null!==c&&c.addEventListener("click",d)})();